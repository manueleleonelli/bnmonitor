<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="An implementation of sensitivity and robustness methods in Bayesian networks in R. It includes methods to perform parameter variations via a variety of co-variation schemes, to compute sensitivity functions and to quantify the dissimilarity of two Bayesian networks via distances and divergences. It further includes diagnostic methods to assess the goodness of fit of a Bayesian networks to data, including global, node and parent-child monitors. References: H. Chan, A. Darwiche (2002) &lt;doi:10.1613/jair.967&gt;; R.G. Cowell, R.J. Verrall, Y.K. Yoon (2007) &lt;doi:10.1111/j.1539-6975.2007.00235.x&gt;; C. Goergen, M. Leonelli (2020) &lt;ArXiv:1809.10794&gt;. ">
<title>An Implementation of Sensitivity Analysis in Bayesian Networks • bnmonitor</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="An Implementation of Sensitivity Analysis in Bayesian Networks">
<meta property="og:description" content="An implementation of sensitivity and robustness methods in Bayesian networks in R. It includes methods to perform parameter variations via a variety of co-variation schemes, to compute sensitivity functions and to quantify the dissimilarity of two Bayesian networks via distances and divergences. It further includes diagnostic methods to assess the goodness of fit of a Bayesian networks to data, including global, node and parent-child monitors. References: H. Chan, A. Darwiche (2002) &lt;doi:10.1613/jair.967&gt;; R.G. Cowell, R.J. Verrall, Y.K. Yoon (2007) &lt;doi:10.1111/j.1539-6975.2007.00235.x&gt;; C. Goergen, M. Leonelli (2020) &lt;ArXiv:1809.10794&gt;. ">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="index.html">bnmonitor</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="reference/index.html">Reference</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="bnmonitor">bnmonitor<a class="anchor" aria-label="anchor" href="#bnmonitor"></a>
</h1></div>
<p><code>bnmonitor</code> is a package for sensitivity analysis and robustness in Bayesian networks (BNs).</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>The package <code>bnmonitor</code> can be installed from GitHub using the command</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># install.packages("devtools")</span>
<span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"manueleleonelli/bnmonitor"</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; * checking for file 'C:\Users\Manuele.Leonelli\AppData\Local\Temp\RtmpagcbTt\remotesda4396c5d90\manueleleonelli-bnmonitor-bbfcea8/DESCRIPTION' ... OK</span>
<span class="co">#&gt; * preparing 'bnmonitor':</span>
<span class="co">#&gt; * checking DESCRIPTION meta-information ... OK</span>
<span class="co">#&gt; * checking for LF line-endings in source and make files and shell scripts</span>
<span class="co">#&gt; * checking for empty or unneeded directories</span>
<span class="co">#&gt;   NB: this package now depends on R (&gt;= 3.5.0)</span>
<span class="co">#&gt;   WARNING: Added dependency on R &gt;= 3.5.0 because serialized objects in</span>
<span class="co">#&gt;   serialize/load version 3 cannot be read in older versions of R.</span>
<span class="co">#&gt;   File(s) containing such objects:</span>
<span class="co">#&gt;     'bnmonitor/data/cachexia_ci.RData'</span>
<span class="co">#&gt;     'bnmonitor/data/cachexia_data.RData'</span>
<span class="co">#&gt;     'bnmonitor/data/cachexia_gbn.RData' 'bnmonitor/data/chds.RData'</span>
<span class="co">#&gt;     'bnmonitor/data/chds_bn.RData' 'bnmonitor/data/chds_bn.fit.RData'</span>
<span class="co">#&gt;     'bnmonitor/data/control_ci.RData' 'bnmonitor/data/control_gbn.RData'</span>
<span class="co">#&gt;     'bnmonitor/data/diabetes.RData' 'bnmonitor/data/mathmarks.RData'</span>
<span class="co">#&gt;     'bnmonitor/data/synthetic_ci.RData'</span>
<span class="co">#&gt;     'bnmonitor/data/synthetic_gbn.RData'</span>
<span class="co">#&gt; * building 'bnmonitor_0.1.2.tar.gz'</span>
<span class="co">#&gt; </span></code></pre></div>
<p>and loaded in R with</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://manueleleonelli.github.io/bnmonitor/">bnmonitor</a></span><span class="op">)</span></code></pre></div>
<p>Note that <code>bnmonitor</code> requires the package <code>gRain</code> which, while on CRAN, depends on packages that are on Bioconductor both directly and through the <code>gRbase</code> package, which depends on <code>RBGL</code>:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"BiocManager"</span><span class="op">)</span>
<span class="fu">BiocManager</span><span class="fu">::</span><span class="fu">install</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"graph"</span>, <span class="st">"Rgraphviz"</span>, <span class="st">"RBGL"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"gRain"</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p><code>bnmonitor</code> provides a suite of function to investigate either a data-learnt or an expert elicited BN. Its functions can be classified into three main areas:</p>
<ul>
<li>
<em>Robustness in discrete BNs</em>: checking how well a BN represents a dataset;</li>
<li>
<em>Sensitivity in discrete BNs</em>: assessing the effect of changes in the discrete BN’s probabilities;</li>
<li>
<em>Sensitivity in continuous BNs</em>: assessing the effect of changes in the continuous BN’s probabilities, either in the standard or model-preserving framework</li>
</ul>
<!-- The prequential diagnostics examine the forecasts that flow from a model in sequence. --><!-- Each monitor given below indicates the probability of a particular observation based on the previous observations and the model structure.  --><!-- In the prequential mindset, we compute a probability of each subsequent observation based on all previous data points.  --><!-- These observations are then scored, and in this package we use the logarithmic score function. --><!-- The observations are then standardized to give a z-score statistic.  --><!-- Following the recommendation of Cowell (2007), scores indicate a poor fit where |z| > 1.96  --><!-- We demonstrate the efficacy of the prequential monitors with the Asia data set from the bnlearn package. Details of the variables (nodes) can be found in the documentation for bnlearn. -->
</div>
<div class="section level2">
<h2 id="robustness">Robustness<a class="anchor" aria-label="anchor" href="#robustness"></a>
</h2>
<p>Consider the <code>asia</code> dataset available from <code>bnlearn</code>. Details of the variables can be found in the <code>bnlearn</code> documentation.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://www.bnlearn.com/" class="external-link">bnlearn</a></span><span class="op">)</span>
<span class="co">#&gt; Warning: package 'bnlearn' was built under R version 4.1.1</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">asia</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">asia</span><span class="op">)</span>
<span class="co">#&gt;    A          S          T          L          B          E          X       </span>
<span class="co">#&gt;  no :4958   no :2485   no :4956   no :4670   no :2451   no :4630   no :4431  </span>
<span class="co">#&gt;  yes:  42   yes:2515   yes:  44   yes: 330   yes:2549   yes: 370   yes: 569  </span>
<span class="co">#&gt;    D       </span>
<span class="co">#&gt;  no :2650  </span>
<span class="co">#&gt;  yes:2350</span></code></pre></div>
<p>Consider two candidate BN models (Lauritzen and Spiegelhalter, 1988), which only differ in the edge from <code>S</code> to <code>D</code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">asia_bn</span> <span class="op">&lt;-</span> <span class="fu">bnlearn</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/bnlearn/man/modelstring.html" class="external-link">model2network</a></span><span class="op">(</span><span class="st">"[A][S][T|A][L|S][B|S][D|B:E][E|T:L][X|E]"</span><span class="op">)</span>
<span class="fu">bnlearn</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/bnlearn/man/graphviz.plot.html" class="external-link">graphviz.plot</a></span><span class="op">(</span><span class="va">asia_bn</span><span class="op">)</span> </code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-6-1.png" width="50%"></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">asia_bn_alt</span> <span class="op">&lt;-</span>  <span class="fu">bnlearn</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/bnlearn/man/modelstring.html" class="external-link">model2network</a></span><span class="op">(</span><span class="st">"[A][S][T|A][L|S][B|S][E|T:L][X|E][D|B:E:S]"</span><span class="op">)</span>
<span class="fu">bnlearn</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/bnlearn/man/graphviz.plot.html" class="external-link">graphviz.plot</a></span><span class="op">(</span><span class="va">asia_bn_alt</span><span class="op">)</span> </code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-6-2.png" width="50%"></p>
<div class="section level3">
<h3 id="global-monitor">Global monitor<a class="anchor" aria-label="anchor" href="#global-monitor"></a>
</h3>
<!-- The global monitor is equivalent to the Bayes Factor and offers a good assessment of the model as a whole.  -->
<!-- It is primarily useful for differentiating between candidate models as the global monitor pinpoints the nodes with different contributions for two candidate models. -->
<!-- We can assess the log likelihood contribution from each of the nodes and determine which nodes contribute the most to the global monitor. -->
<!-- global.monitor.graph provides a quick visual for the entire network.  -->
<!-- The darker the color, the more substantial the contribution of that node to the log likelihood. -->
<!-- The global monitor assesses the probability of observing the data given the model and as such does not particularly fit the prequential view.  -->
<!-- However, it is a quick and useful first diagnostic assessment. -->
<p>A first useful diagnostic is the <code>global_monitor</code>, reporting the contribution of each vertex to the log-likelihood of the model.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">glob_asia</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/node_monitor.html">node_monitor</a></span><span class="op">(</span>dag <span class="op">=</span> <span class="va">asia_bn</span>, df <span class="op">=</span> <span class="va">asia</span>, alpha <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>
<span class="va">glob_asia_alt</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/node_monitor.html">node_monitor</a></span><span class="op">(</span>dag <span class="op">=</span> <span class="va">asia_bn_alt</span>, df <span class="op">=</span> <span class="va">asia</span>, alpha <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>
<span class="va">glob_asia</span>
<span class="co">#&gt;   Vertex      Score</span>
<span class="co">#&gt; 1      A  249.74568</span>
<span class="co">#&gt; 2      B 3020.72273</span>
<span class="co">#&gt; 3      D 2144.16059</span>
<span class="co">#&gt; 4      E   26.31263</span>
<span class="co">#&gt; 5      L 1101.55381</span>
<span class="co">#&gt; 6      S 3469.43743</span>
<span class="co">#&gt; 7      T  260.38452</span>
<span class="co">#&gt; 8      X  851.22579</span>
<span class="va">glob_asia_alt</span>
<span class="co">#&gt;   Vertex      Score</span>
<span class="co">#&gt; 1      A  249.74568</span>
<span class="co">#&gt; 2      B 3020.72273</span>
<span class="co">#&gt; 3      D 2153.19484</span>
<span class="co">#&gt; 4      E   26.31263</span>
<span class="co">#&gt; 5      L 1101.55381</span>
<span class="co">#&gt; 6      S 3469.43743</span>
<span class="co">#&gt; 7      T  260.38452</span>
<span class="co">#&gt; 8      X  851.22579</span></code></pre></div>
<p>In the alternative model, Dysnopea contributes more to the log-likelihood.</p>
<p>Global monitors can be plotted giving a quick view of the decomposition of the log-likelihood. The darker the color, the more substantial the contribution of a vertex.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/plot.html">plot</a></span><span class="op">(</span><span class="va">glob_asia</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-8-1.png" width="50%"></p>
</div>
<div class="section level3">
<h3 id="node-monitor">Node monitor<a class="anchor" aria-label="anchor" href="#node-monitor"></a>
</h3>
<p>There are two variants of node monitors.</p>
<ul>
<li><p>The marginal node monitor computes the probability of the <img src="https://latex.codecogs.com/png.image?%5Cdpi%7B110%7D&amp;space;%5Cbg_white&amp;space;i" title="i" alt="i">th observation in the data set in turn after passing the evidence of the <img src="https://latex.codecogs.com/png.image?%5Cdpi%7B110%7D&amp;space;%5Cbg_white&amp;space;i-1" title="i-1" alt="i-1">th cases in the data set.</p></li>
<li><p>The conditional node monitor computes the probability of the <img src="https://latex.codecogs.com/png.image?%5Cdpi%7B110%7D&amp;space;%5Cbg_white&amp;space;i" title="i" alt="i">th observation in the data set after passing evidence of the <img src="https://latex.codecogs.com/png.image?%5Cdpi%7B110%7D&amp;space;%5Cbg_white&amp;space;i-1" title="i-1" alt="i-1">th cases in the data set, and the evidence for all nodes in the <img src="https://latex.codecogs.com/png.image?%5Cdpi%7B110%7D&amp;space;%5Cbg_white&amp;space;i" title="i" alt="i">th case except the node of interest.</p></li>
</ul>
<p>As a quick survey of the nodes, the <code>node_monitor</code> command computes the marginal and conditional monitors for the final observation in the data set.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">node_asia</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/final_node_monitor.html">final_node_monitor</a></span><span class="op">(</span>dag <span class="op">=</span> <span class="va">asia_bn</span>, df <span class="op">=</span> <span class="va">asia</span><span class="op">)</span>
<span class="va">node_asia</span>
<span class="co">#&gt;   node marg.z.score cond.z.score</span>
<span class="co">#&gt; 1    A   -0.1029759   -0.1029862</span>
<span class="co">#&gt; 2    S -114.8350581 -118.7946397</span>
<span class="co">#&gt; 3    T   -0.1054182   -0.1054288</span>
<span class="co">#&gt; 4    L   -0.3013303   -0.3013649</span>
<span class="co">#&gt; 5    B  -34.6833789  -35.0407002</span>
<span class="co">#&gt; 6    E   -0.3226028   -0.3226405</span>
<span class="co">#&gt; 7    X   -0.4234203   -0.4234785</span>
<span class="co">#&gt; 8    D  -10.4048397  -10.3678671</span></code></pre></div>
<p>The scores indicate a poor fit of the probability distributions specified for the Smoking, Bronchitis, and Dysnopea nodes, since these are larger than 1.96 in absolute value. Plots can also be created to give a visual counterpart of the node monitors.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/plot.html">plot</a></span><span class="op">(</span><span class="va">node_asia</span>, which <span class="op">=</span> <span class="st">"marginal"</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-10-1.png" width="50%"></p>
<!-- The modeller may decide which of these distributions is of the most interest.  -->
<!-- For the purposes of this vignette, we assume that we would like to check the forecasts for Dysnopea.  -->
<p>As an illustration we investigate further the fit of the variable Dysnopea.</p>
<p>The sequential marginal monitor <code>seq_marg_monitor</code> gives us a closer look at which particular forecasts in the data set might cause this poor fit. We examine the sequential monitor for both candidate models.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">seq_asia</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/seq_node_monitor.html">seq_marg_monitor</a></span><span class="op">(</span>dag <span class="op">=</span> <span class="va">asia_bn</span>, df <span class="op">=</span> <span class="va">asia</span>, node.name <span class="op">=</span> <span class="st">"D"</span><span class="op">)</span>
<span class="va">seq_asia_alt</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/seq_node_monitor.html">seq_marg_monitor</a></span><span class="op">(</span>dag <span class="op">=</span> <span class="va">asia_bn_alt</span>, df <span class="op">=</span> <span class="va">asia</span>, node.name <span class="op">=</span> <span class="st">"D"</span><span class="op">)</span>
<span class="va">seq_asia</span>
<span class="co">#&gt; Marginal Node Monitor for D </span>
<span class="co">#&gt;  Minimum      -2.182895 </span>
<span class="co">#&gt;  Maximum      0.446613</span>
<span class="va">seq_asia_alt</span>
<span class="co">#&gt; Marginal Node Monitor for D </span>
<span class="co">#&gt;  Minimum      -2.408245 </span>
<span class="co">#&gt;  Maximum      0.1543135</span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">gridExtra</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html" class="external-link">grid.arrange</a></span><span class="op">(</span><span class="fu"><a href="reference/plot.html">plot</a></span><span class="op">(</span><span class="va">seq_asia</span><span class="op">)</span>,<span class="fu"><a href="reference/plot.html">plot</a></span><span class="op">(</span><span class="va">seq_asia_alt</span><span class="op">)</span>,ncol<span class="op">=</span><span class="fl">2</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-12-1.png" width="50%"></p>
<p>Both monitors indicate that for some observations there is a poor fit (score above 1.96 in absolute value). In particular for the alternative models the marginal monitor has larger values in absolute value.</p>
<p>A similar analysis can be conducted with <code>seq_marg_monitor</code>, which would show that the model fits well (not reported here).</p>
</div>
<div class="section level3">
<h3 id="parent-child-monitor">Parent Child monitor<a class="anchor" aria-label="anchor" href="#parent-child-monitor"></a>
</h3>
<p>Once a vertex has been identified as a poor fit, further investigation can be carried out to check for which values of the parents the model provides a bad representation. This can be achieved with the <code>seq_pa_ch_monitor</code> function.</p>
<p>As an illustration consider the <code>asia_bn</code> BN, the vertex <code>D</code> (Dysnopea), the parent variable <code>B</code> (Bronchitis) which can take values <code>yes</code> and <code>no</code>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">asia_pa_ch1</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/seq_pa_ch_monitor.html">seq_pa_ch_monitor</a></span><span class="op">(</span>dag <span class="op">=</span> <span class="va">asia_bn</span>, df <span class="op">=</span> <span class="va">asia</span>, node.name <span class="op">=</span> <span class="st">"D"</span>, pa.names <span class="op">=</span>  <span class="st">"B"</span>, pa.val <span class="op">=</span>  <span class="st">"yes"</span>, alpha <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>
<span class="va">asia_pa_ch1</span>
<span class="co">#&gt; Parent Child Node Monitor </span>
<span class="co">#&gt;  Minimum      -1.674971 </span>
<span class="co">#&gt;  Maximum      2.158953</span>
<span class="va">asia_pa_ch2</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/seq_pa_ch_monitor.html">seq_pa_ch_monitor</a></span><span class="op">(</span>dag <span class="op">=</span> <span class="va">asia_bn</span>, df <span class="op">=</span> <span class="va">asia</span>, node.name <span class="op">=</span> <span class="st">"D"</span>, pa.names <span class="op">=</span> <span class="st">"B"</span>, pa.val <span class="op">=</span> <span class="st">"no"</span>, alpha <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>
<span class="va">asia_pa_ch2</span>
<span class="co">#&gt; Parent Child Node Monitor </span>
<span class="co">#&gt;  Minimum      -1.911069 </span>
<span class="co">#&gt;  Maximum      1.629946</span>
<span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html" class="external-link">grid.arrange</a></span><span class="op">(</span><span class="fu"><a href="reference/plot.html">plot</a></span><span class="op">(</span><span class="va">asia_pa_ch1</span><span class="op">)</span>,<span class="fu"><a href="reference/plot.html">plot</a></span><span class="op">(</span><span class="va">asia_pa_ch2</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-13-1.png" width="50%"></p>
<p>For this model, Dysnopea is adequately modeled for both values of Bronchitis, since most scores largely fall in the recommended range.</p>
</div>
<div class="section level3">
<h3 id="influential-observations">Influential observations<a class="anchor" aria-label="anchor" href="#influential-observations"></a>
</h3>
<p>The last robustness tool is the absolute value of the log-likelihood ratio between a model learnt without one observation and the one learnt with the full dataset. Larger values are associated to atomic events which influence the structural learning.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">influence</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/influential_obs.html">influential_obs</a></span><span class="op">(</span>dag <span class="op">=</span> <span class="va">asia_bn</span>, df <span class="op">=</span> <span class="va">asia</span>, alpha <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">influence</span><span class="op">)</span>
<span class="co">#&gt;    A   S   T  L   B   E   X   D    score</span>
<span class="co">#&gt; 1 no yes  no no yes  no  no yes 1.448996</span>
<span class="co">#&gt; 2 no yes  no no  no  no  no  no 2.246368</span>
<span class="co">#&gt; 3 no  no yes no  no yes yes yes 6.218600</span>
<span class="co">#&gt; 4 no  no  no no yes  no  no yes 2.223474</span>
<span class="co">#&gt; 5 no  no  no no  no  no  no yes 3.435658</span>
<span class="co">#&gt; 6 no yes  no no  no  no  no yes 4.443592</span>
<span class="fu"><a href="reference/plot.html">plot</a></span><span class="op">(</span><span class="va">influence</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-14-1.png" width="50%"></p>
</div>
</div>
<div class="section level2">
<h2 id="sensitivity-in-discrete-bayesian-networks">Sensitivity in Discrete Bayesian Networks<a class="anchor" aria-label="anchor" href="#sensitivity-in-discrete-bayesian-networks"></a>
</h2>
<p>The functionalities of <code>bnmonitor</code> for sensitivity analysis in Discrete Bayesian Networks are illustrated using the <code>fire_alarm</code> network bundled within the package representing a simple alarm system for fire accidents.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/bnlearn/man/graphviz.plot.html" class="external-link">graphviz.plot</a></span><span class="op">(</span><span class="va">fire_alarm</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-15-1.png" width="50%"></p>
<p>The network consists of 6 nodes (<code>Fire</code>, <code>Smoke</code>, <code>Tampering</code>, <code>Alarm</code>, <code>Leaving</code> and <code>Report</code>) of either two or three levels.</p>
<div class="section level3">
<h3 id="covariation-schemes">Covariation schemes<a class="anchor" aria-label="anchor" href="#covariation-schemes"></a>
</h3>
<p>The aim of a sensitivity analysis is to assess how parameter changes affect output probabilities of interest. When one parameter changes than others need to be adjusted and this can be done in many ways, including <code>proportional</code>, <code>uniform</code> and <code>order-preserving</code> schemes. Suppose we vary the probability that <code>Alarm = FALSE</code> given that <code>Fire = TRUE</code> and <code>Tampering = FALSE</code> from 0.01 to 0.1. The resulting probabilities from the proportional covariation scheme can be computed as follows.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/covariation.html">proportional_covar</a></span><span class="op">(</span>bnfit <span class="op">=</span> <span class="va">fire_alarm</span>, node <span class="op">=</span> <span class="st">"Alarm"</span>, value_node <span class="op">=</span> <span class="st">"FALSE"</span>, value_parents <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"TRUE"</span>,<span class="st">"FALSE"</span><span class="op">)</span>, new_value <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span><span class="op">$</span><span class="va">Alarm</span><span class="op">$</span><span class="va">prob</span>
<span class="co">#&gt; , , Tampering = TRUE</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;              Fire</span>
<span class="co">#&gt; Alarm               TRUE      FALSE</span>
<span class="co">#&gt;   TRUE        0.60000000 0.65000000</span>
<span class="co">#&gt;   MALFUNCTION 0.20000000 0.20000000</span>
<span class="co">#&gt;   FALSE       0.20000000 0.15000000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; , , Tampering = FALSE</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;              Fire</span>
<span class="co">#&gt; Alarm               TRUE      FALSE</span>
<span class="co">#&gt;   TRUE        0.83636364 0.00010000</span>
<span class="co">#&gt;   MALFUNCTION 0.06363636 0.65000000</span>
<span class="co">#&gt;   FALSE       0.10000000 0.34990000</span></code></pre></div>
<p>The functions <code>uniform_covar</code> and <code>orderp_covar</code> have the same inputs and return the BN where probabilities are updated using uniform and order-preserving covariation, respectively.</p>
</div>
<div class="section level3">
<h3 id="sensitivity-functions">Sensitivity functions<a class="anchor" aria-label="anchor" href="#sensitivity-functions"></a>
</h3>
<p>Suppose we are interested in the probability that <code>Report = TRUE</code> and how this varies with respect to the probability that <code>Alarm = FALSE</code> conditional on <code>Fire = TRUE</code> and <code>Tampering = FALSE</code>. This can be computed with the function <code>sensitivity</code>.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sens</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/sensitivity.html">sensitivity</a></span><span class="op">(</span>bnfit <span class="op">=</span> <span class="va">fire_alarm</span>, interest_node <span class="op">=</span> <span class="st">"Report"</span>, interest_node_value <span class="op">=</span>  <span class="st">"TRUE"</span> , node <span class="op">=</span> <span class="st">"Alarm"</span> , value_node <span class="op">=</span> <span class="st">"FALSE"</span>, value_parents <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"TRUE"</span>,<span class="st">"FALSE"</span><span class="op">)</span>, new_value <span class="op">=</span> <span class="st">"all"</span>, covariation <span class="op">=</span> <span class="st">"all"</span><span class="op">)</span>
<span class="fu"><a href="reference/plot.html">plot</a></span><span class="op">(</span><span class="va">sens</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-17-1.png" width="50%"></p>
<p>For all covariation schemes as the conditional probability of <code>Alarm = FALSE</code> increases, the probability of <code>Report = TRUE</code> decreases. The uniform covariation scheme is reported in red, the proportional in green and the order-preserving in blue.</p>
<p>The function sensitivity also allows for conditional probabilities of interest, not only marginals, which can be set by the options <code>evidence_nodes</code> and <code>evidence_states</code>.</p>
<p>For such changes in the probability distribution of a BN, we can compute the distance between the original and the varied networks using the Chan-Darwiche distance (<code>CD</code>) and the Kullback-Leibler divergence (<code>KL</code>). As an example consider <code>Alarm = MALFUNCTIOn</code> conditional on <code>Fire = TRUE</code> and <code>Tampering = FALSE</code>.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cd_distance</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/CD.html">CD</a></span><span class="op">(</span><span class="va">fire_alarm</span>, node <span class="op">=</span> <span class="st">"Alarm"</span>, value_node <span class="op">=</span> <span class="st">"MALFUNCTION"</span>, value_parents <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"TRUE"</span>,<span class="st">"FALSE"</span><span class="op">)</span>, new_value <span class="op">=</span> <span class="st">"all"</span>, covariation <span class="op">=</span> <span class="st">"all"</span><span class="op">)</span>
<span class="va">kl_divergence</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/KL.html">KL</a></span><span class="op">(</span><span class="va">fire_alarm</span>, node <span class="op">=</span> <span class="st">"Alarm"</span>, value_node <span class="op">=</span> <span class="st">"MALFUNCTION"</span>, value_parents <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"TRUE"</span>,<span class="st">"FALSE"</span><span class="op">)</span>, new_value <span class="op">=</span> <span class="st">"all"</span>, covariation <span class="op">=</span> <span class="st">"all"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html" class="external-link">grid.arrange</a></span><span class="op">(</span><span class="fu"><a href="reference/plot.html">plot</a></span><span class="op">(</span><span class="va">cd_distance</span><span class="op">)</span>, <span class="fu"><a href="reference/plot.html">plot</a></span><span class="op">(</span><span class="va">kl_divergence</span><span class="op">)</span>,ncol<span class="op">=</span><span class="fl">2</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-18-1.png" width="50%"></p>
<p>As expected proportional covariation has the smallest distance/divergence of all covariation schemes.</p>
</div>
<div class="section level3">
<h3 id="sensitivity-queries">Sensitivity queries<a class="anchor" aria-label="anchor" href="#sensitivity-queries"></a>
</h3>
<p>Another task in sensitivity analysis is to identify parameter changes that meet a specific constraint. As an example suppose we want the probability <code>Report = TRUE</code> to be equal to 0.4. Which parameters could we change to obtain such a probability? The answer can be obtained using the function <code>sensquery</code>.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/sensquery.html">sensquery</a></span><span class="op">(</span>bnfit <span class="op">=</span> <span class="va">fire_alarm</span>, interest_node <span class="op">=</span> <span class="st">"Report"</span>, interest_node_value <span class="op">=</span> <span class="st">"TRUE"</span>, new_value <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span>
<span class="co">#&gt;        Node Value node Value parents Original value Suggested change</span>
<span class="co">#&gt; 1   Leaving       TRUE   MALFUNCTION         0.7300        0.7983961</span>
<span class="co">#&gt; 2    Report       TRUE          TRUE         0.7500        0.8164951</span>
<span class="co">#&gt; 3 Tampering       TRUE                       0.0200        0.2018769</span>
<span class="co">#&gt; 4      Fire       TRUE                       0.0100        0.1252059</span>
<span class="co">#&gt; 5     Alarm       TRUE   FALSE,FALSE         0.0001        0.1106591</span>
<span class="co">#&gt;   CD distance</span>
<span class="co">#&gt; 1   0.3816771</span>
<span class="co">#&gt; 2   0.3941673</span>
<span class="co">#&gt; 3   2.5172158</span>
<span class="co">#&gt; 4   2.6510913</span>
<span class="co">#&gt; 5   7.1262142</span></code></pre></div>
<p>There are five parameter changes that would lead to a probability of <code>Report = TRUE</code> of 0.4. These are ordered by the value of the CD distance between the original and the new network, from smallest to largest.</p>
</div>
</div>
<div class="section level2">
<h2 id="gaussian-bayesian-networks">Gaussian Bayesian networks<a class="anchor" aria-label="anchor" href="#gaussian-bayesian-networks"></a>
</h2>
<p>The functionalities of <code>bnmonitor</code> for sensitivity analysis in Gaussian BNs are illustrated next using the <code>mathmarks</code> dataset bundled within the package.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">mathmarks</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">mathmarks</span><span class="op">)</span>
<span class="co">#&gt;   mechanics vectors algebra analysis statistics</span>
<span class="co">#&gt; 1        77      82      67       67         81</span>
<span class="co">#&gt; 2        63      78      80       70         81</span>
<span class="co">#&gt; 3        75      73      71       66         81</span>
<span class="co">#&gt; 4        55      72      63       70         68</span>
<span class="co">#&gt; 5        63      63      65       70         63</span>
<span class="co">#&gt; 6        53      61      72       64         73</span></code></pre></div>
<p>The data includes the grades (out of 100) of students in five maths exams: mechanics, vectors, algebra, analysis and statistics.</p>
<p>The structure of a BN for this data is first learnt using the package <code>bnlearn</code> and the maximum likelihood estimate of its parameters is computed and stored in <code>bnfit</code>.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/bnlearn/man/hc.html" class="external-link">hc</a></span><span class="op">(</span><span class="va">mathmarks</span><span class="op">)</span>
<span class="fu"><a href="reference/plot.html">plot</a></span><span class="op">(</span><span class="va">bn</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-21-1.png" width="50%"></p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bnfit</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/bnlearn/man/bn.fit.html" class="external-link">bn.fit</a></span><span class="op">(</span><span class="va">bn</span>, <span class="va">mathmarks</span><span class="op">)</span></code></pre></div>
<p>To start the sensitivity analysis for the parameters of the learnt BN, one first need to transform <code>bnfit</code> to objects of class <code>GBN</code> (for standard sensitivity analysis) and <code>CI</code> (for model-preserving sensitivity). This can be done using the functions <code>bn2gbn</code> and <code>bn2ci</code> respectively.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gbn</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/bn2.html">bn2gbn</a></span><span class="op">(</span><span class="va">bnfit</span><span class="op">)</span>
<span class="va">ci</span> <span class="op">&lt;-</span>  <span class="fu"><a href="reference/bn2.html">bn2ci</a></span><span class="op">(</span><span class="va">bnfit</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">gbn</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">ci</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [1] "GBN" "CI"</span></code></pre></div>
<div class="section level3">
<h3 id="perturbation-of-the-mean-vector">Perturbation of the mean vector<a class="anchor" aria-label="anchor" href="#perturbation-of-the-mean-vector"></a>
</h3>
<p>A varied Gaussian BN after a perturbation of an entry of the mean vector can be obtained with the function <code>mean_var</code>, which can only be applied to an object of class <code>GBN</code>. Below, we vary the fifth entry of the mean vector (statistics) by an additive factor 10.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mean_varied</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">gbn</span><span class="op">$</span><span class="va">order</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">gbn</span><span class="op">$</span><span class="va">mean</span>, <span class="fl">2</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="reference/mean_var.html">mean_var</a></span><span class="op">(</span>gbn <span class="op">=</span> <span class="va">gbn</span>, entry <span class="op">=</span> <span class="fl">5</span>, delta <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">$</span><span class="va">mean</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">mean_varied</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Course"</span>, <span class="st">"Original Mean"</span>, <span class="st">"Varied Mean"</span><span class="op">)</span>
<span class="va">mean_varied</span>
<span class="co">#&gt;      Course       Original Mean Varied Mean</span>
<span class="co">#&gt; [1,] "mechanics"  "38.95"       "38.95"    </span>
<span class="co">#&gt; [2,] "vectors"    "50.59"       "50.59"    </span>
<span class="co">#&gt; [3,] "algebra"    "50.6"        "50.6"     </span>
<span class="co">#&gt; [4,] "analysis"   "46.68"       "46.68"    </span>
<span class="co">#&gt; [5,] "statistics" "42.31"       "52.31"</span></code></pre></div>
<p>The overall effect of such variations can be assessed in terms of dissimilarity measures: the Kullback-Leibler divergence (<code>KL</code>) and Jeffrey’s divergence (<code>Jeffreys</code>). For instance, let’s see what’s the effect of variations in the mean of the statistics exam.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">kl_var5</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/KL.html">KL</a></span><span class="op">(</span><span class="va">gbn</span>, where <span class="op">=</span> <span class="st">"mean"</span>, entry <span class="op">=</span> <span class="fl">5</span>, delta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">10</span>,<span class="fl">10</span>,<span class="fl">0.1</span><span class="op">)</span><span class="op">)</span>
<span class="va">jef_var5</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/Jeffreys.html">Jeffreys</a></span><span class="op">(</span><span class="va">gbn</span>, where <span class="op">=</span> <span class="st">"mean"</span>, entry <span class="op">=</span> <span class="fl">5</span>, delta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">10</span>,<span class="fl">10</span>,<span class="fl">0.1</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html" class="external-link">grid.arrange</a></span><span class="op">(</span><span class="fu"><a href="reference/plot.html">plot</a></span><span class="op">(</span><span class="va">kl_var5</span><span class="op">)</span>, <span class="fu"><a href="reference/plot.html">plot</a></span><span class="op">(</span><span class="va">jef_var5</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-24-1.png" width="50%"></p>
<p>More interestingly, one can check the different effect of variations of different parameters (code not shown).</p>
<p><img src="reference/figures/README-unnamed-chunk-25-1.png" width="50%"></p>
<p>Misspecifications of the mean of the algebra exam would have the biggest effect on the distribution of the Gaussian BN, since it leads to the biggest distance between the original and the varied network.</p>
</div>
<div class="section level3">
<h3 id="perturbation-of-the-covariance-matrix">Perturbation of the covariance matrix<a class="anchor" aria-label="anchor" href="#perturbation-of-the-covariance-matrix"></a>
</h3>
<p>Care must be taken when performing perturbations of the covariance matrix, for two reasons:</p>
<ul>
<li><p>the perturbed matrix may not be positive semidefinite;</p></li>
<li><p>the perturbed matrix may not respect the conditional independences of the underlying BN.</p></li>
</ul>
<p>Suppose we are interested in assessing the effect of varying the covariance between <code>Statistics</code> and <code>Vectors</code>.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gbn</span><span class="op">$</span><span class="va">order</span>
<span class="co">#&gt; [1] "mechanics"  "vectors"    "algebra"    "analysis"   "statistics"</span>
<span class="va">gbn</span><span class="op">$</span><span class="va">covariance</span>
<span class="co">#&gt;          [,1]      [,2]      [,3]      [,4]      [,5]</span>
<span class="co">#&gt; [1,] 305.7680 127.22257 101.57941 100.88420 109.66411</span>
<span class="co">#&gt; [2,] 127.2226 174.23649  85.65601  85.06978  92.47337</span>
<span class="co">#&gt; [3,] 101.5794  85.65601 114.56549 113.78140 123.68375</span>
<span class="co">#&gt; [4,] 100.8842  85.06978 113.78140 223.30480 157.73746</span>
<span class="co">#&gt; [5,] 109.6641  92.47337 123.68375 157.73746 303.49318</span></code></pre></div>
<p>The parameter of interest correspond to the entry (2,5) of the covariance matrix.</p>
<p>A standard perturbed covariance matrix can be constructed with the <code>covariance_var</code> function. Suppose we want to increase the covariance between <code>Statistics</code> and <code>Vectors</code> by an additive factor of 10.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">d</span> <span class="op">&lt;-</span> <span class="fl">10</span>
<span class="fu"><a href="reference/covariance_var.html">covariance_var</a></span><span class="op">(</span><span class="va">gbn</span>, entry <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">5</span><span class="op">)</span>, delta <span class="op">=</span> <span class="va">d</span><span class="op">)</span><span class="op">$</span><span class="va">covariance</span>
<span class="co">#&gt;          [,1]      [,2]      [,3]      [,4]     [,5]</span>
<span class="co">#&gt; [1,] 305.7680 127.22257 101.57941 100.88420 109.6641</span>
<span class="co">#&gt; [2,] 127.2226 174.23649  85.65601  85.06978 102.4734</span>
<span class="co">#&gt; [3,] 101.5794  85.65601 114.56549 113.78140 123.6837</span>
<span class="co">#&gt; [4,] 100.8842  85.06978 113.78140 223.30480 157.7375</span>
<span class="co">#&gt; [5,] 109.6641 102.47337 123.68375 157.73746 303.4932</span></code></pre></div>
<p>The above perturbation made the original network structure not valid for the new covariation matrix. In order to ensure that the perturbed covariance is still valid for the underlying network structure, we can use model-preserving methods. These apply multiplicatively and not additively as standard methods, but we apply the same change in the covariance via the perturbation <code>delta</code> defined below. We can construct various covariation matrices using the following commands:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">delta</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">d</span> <span class="op">+</span> <span class="va">gbn</span><span class="op">$</span><span class="va">covariance</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">5</span><span class="op">]</span><span class="op">)</span><span class="op">/</span><span class="va">gbn</span><span class="op">$</span><span class="va">covariance</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">5</span><span class="op">]</span>
<span class="fu"><a href="reference/covariation_matrix.html">total_covar_matrix</a></span><span class="op">(</span><span class="va">ci</span>, entry <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">5</span><span class="op">)</span>, delta <span class="op">=</span> <span class="va">delta</span><span class="op">)</span>
<span class="co">#&gt;          [,1]     [,2]     [,3]     [,4]     [,5]</span>
<span class="co">#&gt; [1,] 1.108139 1.108139 1.108139 1.108139 1.108139</span>
<span class="co">#&gt; [2,] 1.108139 1.108139 1.108139 1.108139 1.000000</span>
<span class="co">#&gt; [3,] 1.108139 1.108139 1.108139 1.108139 1.108139</span>
<span class="co">#&gt; [4,] 1.108139 1.108139 1.108139 1.108139 1.108139</span>
<span class="co">#&gt; [5,] 1.108139 1.000000 1.108139 1.108139 1.108139</span>
<span class="fu"><a href="reference/covariation_matrix.html">partial_covar_matrix</a></span><span class="op">(</span><span class="va">ci</span>, entry <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">5</span><span class="op">)</span>, delta <span class="op">=</span> <span class="va">delta</span><span class="op">)</span>
<span class="co">#&gt;          [,1]     [,2]     [,3]     [,4]     [,5]</span>
<span class="co">#&gt; [1,] 1.000000 1.000000 1.108139 1.108139 1.108139</span>
<span class="co">#&gt; [2,] 1.000000 1.000000 1.108139 1.108139 1.000000</span>
<span class="co">#&gt; [3,] 1.108139 1.108139 1.108139 1.108139 1.108139</span>
<span class="co">#&gt; [4,] 1.108139 1.108139 1.108139 1.108139 1.108139</span>
<span class="co">#&gt; [5,] 1.108139 1.000000 1.108139 1.108139 1.000000</span>
<span class="fu"><a href="reference/covariation_matrix.html">row_covar_matrix</a></span><span class="op">(</span><span class="va">ci</span>, entry <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">5</span><span class="op">)</span>, delta <span class="op">=</span> <span class="va">delta</span><span class="op">)</span>
<span class="co">#&gt;          [,1] [,2]     [,3]     [,4]     [,5]</span>
<span class="co">#&gt; [1,] 1.000000    1 1.000000 1.000000 1.108139</span>
<span class="co">#&gt; [2,] 1.000000    1 1.000000 1.000000 1.000000</span>
<span class="co">#&gt; [3,] 1.000000    1 1.000000 1.000000 1.108139</span>
<span class="co">#&gt; [4,] 1.000000    1 1.000000 1.000000 1.108139</span>
<span class="co">#&gt; [5,] 1.108139    1 1.108139 1.108139 1.000000</span>
<span class="fu"><a href="reference/covariation_matrix.html">col_covar_matrix</a></span><span class="op">(</span><span class="va">ci</span>, entry <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">5</span><span class="op">)</span>, delta <span class="op">=</span> <span class="va">delta</span><span class="op">)</span>
<span class="co">#&gt;      [,1]     [,2]     [,3]     [,4] [,5]</span>
<span class="co">#&gt; [1,]    1 1.000000 1.000000 1.000000    1</span>
<span class="co">#&gt; [2,]    1 1.000000 1.108139 1.108139    1</span>
<span class="co">#&gt; [3,]    1 1.108139 1.000000 1.000000    1</span>
<span class="co">#&gt; [4,]    1 1.108139 1.000000 1.000000    1</span>
<span class="co">#&gt; [5,]    1 1.000000 1.000000 1.000000    1</span></code></pre></div>
<p>Importantly, notice that standard methods are applied to objects of class <code>gbn</code>, whilst model-preserving methods operate over <code>ci</code> objects.</p>
<p>For any of the four available methods (<code>total</code>, <code>partial</code>, <code>row</code> and <code>column</code>) the perturbed covariance matrix can be calculated with the function <code>model_pres_cov</code>. For instance in the case of a partial covariation:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/model_pres_cov.html">model_pres_cov</a></span><span class="op">(</span><span class="va">ci</span>, type <span class="op">=</span> <span class="st">"partial"</span>, entry <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">5</span><span class="op">)</span>, delta <span class="op">=</span> <span class="va">delta</span><span class="op">)</span><span class="op">$</span><span class="va">covariance</span>
<span class="co">#&gt;          [,1]      [,2]      [,3]      [,4]     [,5]</span>
<span class="co">#&gt; [1,] 305.7680 127.22257 112.56414 111.79374 121.5231</span>
<span class="co">#&gt; [2,] 127.2226 174.23649  94.91879  94.26916 102.4734</span>
<span class="co">#&gt; [3,] 112.5641  94.91879 126.95451 126.08563 137.0588</span>
<span class="co">#&gt; [4,] 111.7937  94.26916 126.08563 247.45281 174.7951</span>
<span class="co">#&gt; [5,] 121.5231 102.47337 137.05881 174.79507 303.4932</span></code></pre></div>
<p>Having constructed various covariation matrices, we can assess how far apart the original and the perturbed distributions are for various covariation methods. Available dissimilarity measures are Frobenius norm (<code>Fro</code>), Kullback-Leibler divergence (<code>KL</code>) and Jeffrey’s divergence (<code>Jeffreys</code>). Let’s consider the Frobenius norm.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">10</span>, <span class="fl">10</span>, <span class="fl">0.1</span><span class="op">)</span>
<span class="va">delta</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">d</span> <span class="op">+</span> <span class="va">gbn</span><span class="op">$</span><span class="va">covariance</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">5</span><span class="op">]</span><span class="op">)</span><span class="op">/</span><span class="va">gbn</span><span class="op">$</span><span class="va">covariance</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">5</span><span class="op">]</span>
<span class="va">cov_stand</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/Fro.html">Fro</a></span><span class="op">(</span><span class="va">gbn</span>, entry <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">5</span><span class="op">)</span>, delta <span class="op">=</span> <span class="va">d</span><span class="op">)</span>
<span class="va">cov_col</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/Fro.html">Fro</a></span><span class="op">(</span><span class="va">ci</span>, type <span class="op">=</span> <span class="st">"column"</span>, entry <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">5</span><span class="op">)</span>, delta <span class="op">=</span> <span class="va">delta</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html" class="external-link">grid.arrange</a></span><span class="op">(</span><span class="fu"><a href="reference/plot.html">plot</a></span><span class="op">(</span><span class="va">cov_stand</span><span class="op">)</span>, <span class="fu"><a href="reference/plot.html">plot</a></span><span class="op">(</span><span class="va">cov_col</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-30-1.png" width="50%"></p>
<p>As for the mean, we can check which entry of the covariance matrix has the biggest impact if varied. For simplicity here we pick the standard method only (code not shown).</p>
<p><img src="reference/figures/README-unnamed-chunk-31-1.png" width="50%"></p>
<p>From the above plot we can notice that the less robust entries of the covariance matrix are the variance of <code>algebra</code>, the covariance between <code>algebra</code> and <code>analysis</code>, and the covariance between <code>algebra</code> and <code>vectors</code>.</p>
<p>Another method to quickly have an overview of the effect of all parameters is <code>KL_bounds</code> which creates a table with upper bounds to the Kullback-Leibler divergence for all entries of the covariance matrix and all covariation methods.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/KL_bounds.html">KL_bounds</a></span><span class="op">(</span><span class="va">ci</span>, delta <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span>
<span class="co">#&gt;    row col   standard    total  partial row_based col_based</span>
<span class="co">#&gt; 1    1   1 0.08745398 2.721918 2.410370  2.410370  2.410370</span>
<span class="co">#&gt; 2    1   2 0.11113375 2.721918 2.424361  2.424361  2.424361</span>
<span class="co">#&gt; 3    1   3 0.18319140 2.721918 2.661624  2.563009  2.563009</span>
<span class="co">#&gt; 4    1   4 0.03157487 2.721918 2.661624  2.563009  2.563009</span>
<span class="co">#&gt; 5    1   5 0.02356461 2.721918 2.661624  2.508260  2.508260</span>
<span class="co">#&gt; 6    2   2 0.10479440 2.721918 2.410370  2.410370  2.410370</span>
<span class="co">#&gt; 7    2   3 0.34492801 2.721918 2.661624  2.563009  2.563009</span>
<span class="co">#&gt; 8    2   4 0.04575001 2.721918 2.661624  2.563009  2.563009</span>
<span class="co">#&gt; 9    2   5 0.03394882 2.721918 2.661624  2.508260  2.508260</span>
<span class="co">#&gt; 10   3   3 0.26127953 2.721918 2.661624  2.563009  2.563009</span>
<span class="co">#&gt; 11   3   4 1.02446834 2.721918 2.661624  2.563009  2.563009</span>
<span class="co">#&gt; 12   3   5 0.54029638 2.721918 2.661624  2.508260  2.508260</span>
<span class="co">#&gt; 13   4   4 0.14403323 2.721918 2.661624  2.563009  2.563009</span>
<span class="co">#&gt; 14   4   5 0.19426900 2.721918 2.661624  2.508260  2.508260</span>
<span class="co">#&gt; 15   5   5 0.11777072 2.721918 2.410370  2.410370  2.410370</span></code></pre></div>
<p>By looking at the standard method column, we have the confirmation that the 11th entry, corresponding to <code>algebra/analysis</code>, is the most critical for the robustness of the network.</p>
</div>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://cloud.r-project.org/package=bnmonitor" class="external-link">View on CRAN</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="https://www.r-project.org/Licenses/GPL-3" class="external-link">GPL-3</a></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing bnmonitor</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Manuele Leonelli <br><small class="roles"> Author, maintainer </small>  </li>
<li>Ramsiya Ramanathan <br><small class="roles"> Author </small>  </li>
<li>Rachel Wilkerson <br><small class="roles"> Author </small>  </li>
</ul>
</div>



  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Manuele Leonelli, Ramsiya Ramanathan, Rachel Wilkerson.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
